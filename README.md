# DiveManager - Syst√®me Complet de Gestion de Mat√©riel de Plong√©e

## üèä‚Äç‚ôÇÔ∏è Description

DiveManager est un syst√®me complet de gestion de mat√©riel de plong√©e avec scanner QR code et NFC int√©gr√©, backend Node.js/Express, base de donn√©es SQLite locale, con√ßu sp√©cialement pour les clubs de plong√©e.

## ‚ú® Fonctionnalit√©s

- **Architecture Compl√®te** : Frontend React + Backend Node.js/Express + SQLite
- **Base de donn√©es SQLite** : Locale, robuste, performante et persistante
- **API REST Compl√®te** : Backend Express avec tous les endpoints
- **Scanner QR Code & NFC** : Check-in/check-out automatique par scan ou NFC
- **Gestion des utilisateurs** : Niveaux de certification FFESSM
- **Suivi des √©quipements** : D√©tendeurs, combinaisons, masques, palmes, gilets, bouteilles
- **Historique complet** : Tous les mouvements sont enregistr√©s
- **Sauvegardes automatiques** : Scripts de sauvegarde SQLite
- **Interface responsive** : Optimis√©e pour mobile et tablette
- **Support NFC** : Lecture de tags NFC sur navigateurs compatibles
- **Installation automatis√©e** : Scripts Debian inclus
- **Production ready** : PM2, Nginx, SSL, sauvegardes

## üèóÔ∏è Architecture

```
DiveManager/
‚îú‚îÄ‚îÄ src/                   # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ components/        # Composants UI
‚îÇ   ‚îú‚îÄ‚îÄ services/          # Services API
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # Utilitaires (NFC, QR)
‚îÇ   ‚îî‚îÄ‚îÄ hooks/             # Hooks React
‚îú‚îÄ‚îÄ server/                # Backend Node.js/Express
‚îÇ   ‚îú‚îÄ‚îÄ src/               # Code source serveur
‚îÇ   ‚îú‚îÄ‚îÄ database/          # Gestion base de donn√©es
‚îÇ   ‚îî‚îÄ‚îÄ routes/            # Routes API
‚îú‚îÄ‚îÄ dist/                  # Build du frontend
‚îî‚îÄ‚îÄ deployment/            # Scripts de d√©ploiement
```

## üöÄ Installation Simple sur Debian

### Installation Automatique (2 commandes)

```bash
# 1. Installation syst√®me
sudo bash deployment/install-complete.sh

# 2. Configuration (apr√®s avoir copi√© les fichiers)
sudo bash deployment/configure-production.sh
```

**C'est tout !** L'application sera accessible sur `http://[IP-de-votre-serveur]`

### D√©tails d'Installation

```bash
# Trouver l'IP de votre serveur
hostname -I

# Exemple d'acc√®s
# Si IP = 192.168.1.100, alors : http://192.168.1.100
```

### Avec Nom de Serveur (Optionnel)

```bash
# Si vous voulez un nom personnalis√©
sudo bash deployment/install-complete.sh monserveur.local
sudo bash deployment/configure-production.sh monserveur.local

# Acc√®s : http://monserveur.local
```

### V√©rification

```bash
# V√©rifier le backend
sudo -u divemanager pm2 status

# V√©rifier Nginx
systemctl status nginx

# Tester l'API
curl http://localhost/api/health

# Voir les logs
tail -f /var/log/divemanager/combined.log
```

## üóÑÔ∏è Base de Donn√©es SQLite

### Structure de la Base

- **users** : Utilisateurs et leurs certifications
- **assets** : √âquipements de plong√©e
- **movements** : Historique des sorties/retours
- **issues** : Probl√®mes signal√©s
- **notifications** : Alertes syst√®me

### Gestion de la Base

```bash
# Initialiser la base (fait automatiquement)
cd /var/www/divemanager/server
node scripts/init-db.js

# Sauvegarde manuelle
node scripts/backup-db.js

# Restaurer une sauvegarde
node scripts/restore-db.js backups/divemanager-backup-2024-01-15.db

# Acc√®s direct SQLite (debug)
sqlite3 divemanager.db
```

## üì° API Backend Compl√®te

### Endpoints Disponibles

```javascript
// === UTILISATEURS ===
GET    /api/users              // Liste des utilisateurs
POST   /api/users              // Cr√©er un utilisateur
PUT    /api/users/:id          // Modifier un utilisateur

// === √âQUIPEMENTS ===
GET    /api/assets             // Liste des √©quipements
POST   /api/assets             // Cr√©er un √©quipement
PUT    /api/assets/:id         // Modifier un √©quipement

// === QR CODE & NFC ===
GET    /api/qr/user/:code      // Recherche utilisateur par QR
GET    /api/qr/asset/:code     // Recherche √©quipement par QR
GET    /api/nfc/user/:nfcId    // Recherche utilisateur par NFC
GET    /api/nfc/asset/:nfcId   // Recherche √©quipement par NFC

// === MOUVEMENTS ===
POST   /api/checkout           // Sortie d'√©quipement
POST   /api/checkin            // Retour d'√©quipement
GET    /api/movements          // Historique des mouvements

// === STATISTIQUES ===
GET    /api/stats              // Statistiques du tableau de bord

// === SANT√â ===
GET    /api/health             // √âtat du serveur et de la base
```

### Exemples d'Utilisation API

```bash
# R√©cup√©rer tous les utilisateurs
curl http://localhost/api/users

# Rechercher un √©quipement par QR code
curl http://localhost/api/qr/asset/DET-001-QR

# Effectuer un checkout
curl -X POST http://localhost/api/checkout \
  -H "Content-Type: application/json" \
  -d '{"assetId":"1","userId":"1","performedBy":"Admin","notes":"Sortie plong√©e"}'

# Statistiques
curl http://localhost/api/stats
```

## üîß D√©veloppement Local

### Backend

```bash
cd server
npm install
npm run dev  # D√©marre sur le port 3001 avec hot-reload
```

### Frontend

```bash
npm install
npm run dev  # D√©marre sur le port 3000
```

### Base de Donn√©es de D√©veloppement

```bash
# La base SQLite est cr√©√©e automatiquement avec des donn√©es de d√©monstration
# Fichier : server/divemanager.db
```

## üöÄ D√©ploiement et Production

### Gestion avec PM2

```bash
# Statut des processus
sudo -u divemanager pm2 status

# Red√©marrer l'application
sudo -u divemanager pm2 restart divemanager-server

# Voir les logs en temps r√©el
sudo -u divemanager pm2 logs divemanager-server

# Monitoring
sudo -u divemanager pm2 monit
```

### Configuration Nginx

Le serveur Nginx est configur√© pour :
- Servir le frontend React sur `/`
- Proxifier l'API sur `/api/`
- G√©rer les routes QR codes `/user/:id` et `/asset/:id`
- Optimisations (gzip, cache, s√©curit√©)

### Sauvegardes Automatiques

```bash
# Sauvegarde quotidienne √† 2h du matin (configur√©e automatiquement)
0 2 * * * cd /var/www/divemanager/server && node scripts/backup-db.js

# Localisation des sauvegardes
ls -la /var/www/divemanager/server/backups/
```

## üîí S√©curit√© et HTTPS

### Installation SSL avec Certbot

```bash
# Installer Certbot
sudo apt install certbot python3-certbot-nginx

# Obtenir le certificat SSL
sudo certbot --nginx -d votre-domaine.com

# Renouvellement automatique (d√©j√† configur√©)
sudo certbot renew --dry-run
```

### Firewall

```bash
# Configuration automatique lors de l'installation
sudo ufw status
```

## üõ†Ô∏è Maintenance et Monitoring

### Logs Syst√®me

```bash
# Logs de l'application
tail -f /var/log/divemanager/combined.log

# Logs Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Logs syst√®me
journalctl -u nginx -f
```

### Mise √† jour de l'Application

```bash
# 1. Sauvegarder la base de donn√©es
cd /var/www/divemanager/server
sudo -u divemanager node scripts/backup-db.js

# 2. Mettre √† jour le code
cd /var/www/divemanager
git pull origin main

# 3. Installer les nouvelles d√©pendances
npm install
cd server && npm install && npm run build && cd ..

# 4. Rebuilder le frontend
npm run build

# 5. Red√©marrer l'application
sudo -u divemanager pm2 restart divemanager-server
systemctl reload nginx
```

### Monitoring des Performances

```bash
# Utilisation des ressources
sudo -u divemanager pm2 monit

# Espace disque
df -h

# Taille de la base de donn√©es
ls -lh /var/www/divemanager/server/divemanager.db
```

## üéØ Points Cl√©s de l'Architecture Compl√®te

‚úÖ **Backend Complet** : API REST Node.js/Express avec SQLite  
‚úÖ **Frontend React** : Interface moderne et responsive  
‚úÖ **Base SQLite** : Persistance locale des donn√©es  
‚úÖ **QR Code + NFC** : Double technologie de scan  
‚úÖ **Installation automatis√©e** : Scripts Debian inclus  
‚úÖ **Production ready** : PM2, Nginx, SSL, monitoring  
‚úÖ **Sauvegardes** : Scripts automatis√©s  
‚úÖ **S√©curit√©** : Firewall, HTTPS, headers s√©curis√©s  
‚úÖ **Maintenance** : Logs, monitoring, mise √† jour  

## üÜò D√©pannage

### Probl√®mes Courants

**Backend ne d√©marre pas :**
```bash
# V√©rifier les logs
sudo -u divemanager pm2 logs divemanager-server

# Red√©marrer
sudo -u divemanager pm2 restart divemanager-server
```

**Base de donn√©es corrompue :**
```bash
# Restaurer depuis une sauvegarde
cd /var/www/divemanager/server
sudo -u divemanager node scripts/restore-db.js backups/derniere-sauvegarde.db
```

**Nginx erreur 502 :**
```bash
# V√©rifier que le backend fonctionne
curl http://localhost:3001/api/health

# Red√©marrer Nginx
systemctl restart nginx
```

### Support et Logs

```bash
# Diagnostic complet
echo "=== STATUS PM2 ===" && sudo -u divemanager pm2 status
echo "=== STATUS NGINX ===" && systemctl status nginx
echo "=== HEALTH CHECK ===" && curl -s http://localhost/api/health | jq
echo "=== DISK SPACE ===" && df -h
echo "=== MEMORY ===" && free -h
```

## üì± Support NFC

### Fonctionnalit√©s NFC

- **Lecture de tags** : Compatible avec les tags NFC programm√©s
- **Support navigateur** : Chrome Android, Samsung Internet
- **Programmation de tags** : √âcriture de donn√©es sur les tags
- **Fallback QR** : Compatibilit√© avec les QR codes existants

### Utilisation NFC

```javascript
import { nfcReader } from './src/utils/nfcReader';

// D√©marrer la lecture NFC
await nfcReader.startReading(
  (result) => console.log('Tag lu:', result),
  (error) => console.error('Erreur:', error)
);

// Programmer un tag
await nfcReader.writeNFC(
  'USER-001',
  () => console.log('Tag programm√©'),
  (error) => console.error('Erreur:', error)
);
```

### Navigateurs Compatibles NFC

- **Chrome Android** : Support complet
- **Samsung Internet** : Support complet  
- **Edge Mobile** : Support partiel
- **Firefox** : En d√©veloppement

## üì± Workflow QR Code & NFC

1. **G√©n√©rer les codes** : Via l'interface d'administration
2. **Programmer les tags NFC** : Fonction d'√©criture int√©gr√©e
3. **Imprimer les √©tiquettes** : QR codes + tags NFC
4. **Scanner utilisateur** : QR ou NFC
5. **Scanner √©quipements** : QR ou NFC
6. **Synchronisation** : Mise √† jour base locale
7. **Historique complet** : Tout est trac√©

## üîß Scripts de Gestion

### Sauvegarde

```bash
# Sauvegarde manuelle
cd server && npm run backup

# Sauvegarde automatique (cron)
0 2 * * * cd /var/www/divemanager/server && npm run backup
```

### Restauration

```bash
# Restaurer depuis une sauvegarde
cd server && npm run restore backups/divemanager-backup-2024-01-15.db
```

## üí° Technologies NFC

- **Web NFC API** : Standard W3C pour navigateurs
- **NDEF** : Format de donn√©es NFC
- **Tags compatibles** : NTAG213, NTAG215, NTAG216
- **Port√©e** : 4cm maximum
- **Vitesse** : Lecture instantan√©e

L'application est maintenant **100% auto-h√©berg√©e** avec support QR Code et NFC ! üöÄ